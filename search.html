---
layout: default
title: Поиск
permalink: /search/
---

<div class="search-container">
    <h1>Поиск по сайту</h1>
    <form action="/search/" method="get" class="search-form">
        <input type="text" name="q" placeholder="Введите запрос" value="{{ page.query }}">
        <button type="submit">Найти</button>
    </form>
    <div id="search-results"></div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Получаем запрос из URL
    const params = new URLSearchParams(window.location.search);
    const query = params.get('q');

    // Если запроса нет, показываем сообщение
    if (!query) {
        document.getElementById('search-results').innerHTML = '<p>Введите поисковый запрос</p>';
        return;
    }

    // Показываем, что идёт загрузка
    document.getElementById('search-results').innerHTML = `<p>Поиск: <strong>${query}</strong></p><div class="search-loading">Загрузка результатов...</div>`;

    // Загружаем индекс поиска из assets/js
    const searchIndexPath = '{{ site.baseurl }}/assets/js/search_index.json';
    fetch(searchIndexPath)
        .then(response => {
            if (!response.ok) {
                throw new Error('Не удалось загрузить индекс поиска: ' + response.status);
            }
            return response.json();
        })
        .then(data => {
            // Выполняем поиск
            const results = searchData(data, query);
            displayResults(results, query);
        })
        .catch(error => {
            console.error('Ошибка:', error);
            document.getElementById('search-results').innerHTML = '<p>Ошибка при поиске. Проверьте консоль для деталей.</p>';
        });
});

function searchData(data, query) {
    const queryLower = query.toLowerCase();
    return data.filter(item => 
        (item.title && item.title.toLowerCase().includes(queryLower)) || 
        (item.content && item.content.toLowerCase().includes(queryLower))
    );
}

function displayResults(results, query) {
    const resultsDiv = document.getElementById('search-results');

    if (results.length === 0) {
        resultsDiv.innerHTML = `<p>Ничего не найдено по запросу: <strong>${query}</strong></p>`;
        return;
    }

    let html = `<p>Найдено ${results.length} результатов по запросу: <strong>${query}</strong></p>`;
    html += '<div class="search-results-list">';

    results.forEach(result => {
        html += `
            <article class="search-result">
                <h2><a href="${result.url}">${result.title}</a></h2>
                <div class="search-excerpt">${result.excerpt || 'Нет краткого описания'}</div>
                <div class="search-meta">
                    ${result.date ? `<time>${result.date}</time>` : ''}
                </div>
            </article>
        `;
    });

    html += '</div>';
    resultsDiv.innerHTML = html;
}
</script>